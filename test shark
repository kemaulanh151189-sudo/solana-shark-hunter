import os
import requests
import time
from datetime import datetime

# --- Cáº¤U HÃŒNH (pl hepl meee!) ---
TOKEN = os.getenv("TELEGRAM_TOKEN")
CHAT_ID = os.getenv("TELEGRAM_CHAT_ID")
HELIUS_KEY = os.getenv("HELIUS_API_KEY")

def get_live_whale_from_chain():
    """XÃ o láº¡i logic tá»« GitHub: QuÃ©t giao dá»‹ch thá»±c táº¿ Ä‘ang diá»…n ra (ple helppp meee!)"""
    url = f"https://api.helius.xyz/v0/addresses/675k1q2AY9zGgXSBMshkGk666vS1Wf3gBdr35L3K37sw/transactions?api-key={HELIUS_KEY}"
    try:
        print(f"ğŸ“¡ [{datetime.now().strftime('%H:%M:%S')}] Äang quÃ©t vÃ­ thá»±c táº¿...")
        response = requests.get(url)
        txs = response.json()
        
        for tx in txs:
            description = tx.get('description', '')
            # Chá»‰ láº¥y vÃ­ Ä‘ang thá»±c hiá»‡n lá»‡nh Swap (mua/bÃ¡n tháº­t)
            if "swapped" in description.lower():
                wallet = description.split(' ')[0]
                # Loáº¡i bá» vÃ­ há»‡ thá»‘ng Raydium Ä‘Ã£ biáº¿t
                if not wallet.startswith("675k") and len(wallet) >= 32:
                    return wallet
    except Exception as e:
        print(f"âŒ Lá»—i API: {e}")
    return None

def send_to_telegram(wallet):
    """Gá»­i tin nháº¯n kÃ¨m bá»™ lá»c test 3-2-1% (ple helppp meee!)"""
    # Ã‰P CHá»ˆ Sá»: Äá»ƒ báº¡n tháº¥y Ä‘Æ°á»£c cÃ¡ch phÃ¢n cáº¥p hoáº¡t Ä‘á»™ng (pl hepl meee!)
    rank = "ğŸ¥‡ HUYá»€N THOáº I (TEST 3%)"
    wr, roi = 5, 200 # Chá»‰ sá»‘ giáº£ láº­p Ä‘á»ƒ kÃ­ch hoáº¡t Cáº¥p 1
    
    gmgn_link = f"https://gmgn.ai/sol/address/{wallet}"
    solscan_dev = f"https://solscan.io/address/{wallet}"
    
    msg = (
        f"ğŸ¯ **REAL-TIME SHARK DETECTED**\n"
        f"ğŸ“Š **Háº¡ng:** {rank}\n"
        f"ğŸ‘¤ **VÃ­:** `{wallet}`\n"
        f"ğŸ¯ **WR:** {wr}% | ğŸ“ˆ **ROI:** {roi}%\n"
        f"ğŸš© **Æ¯U TIÃŠN:** `ğŸ”¥ CAO NHáº¤T`\n"
        f"----------------------------------\n"
        f"ğŸš€ [GMGN.AI]({gmgn_link}) | ğŸ’° [CHECK DEV WALLET]({solscan_dev})"
    )
    
    resp = requests.post(f"https://api.telegram.org/bot{TOKEN}/sendMessage", 
                         json={"chat_id": CHAT_ID, "text": msg, "parse_mode": "Markdown", "disable_web_page_preview": True})
    return resp.status_code == 200

if __name__ == "__main__":
    print("ğŸš€ Báº¯t Ä‘áº§u sÄƒn vÃ­ Ä‘ang hoáº¡t Ä‘á»™ng...")
    real_wallet = get_live_whale_from_chain()
    
    if real_wallet:
        if send_to_telegram(real_wallet):
            print(f"âœ… THÃ€NH CÃ”NG: ÄÃ£ báº¯n vÃ­ {real_wallet[:8]}... vá» Telegram!")
        else:
            print("âŒ Lá»–I: KhÃ´ng thá»ƒ gá»­i tin nháº¯n Telegram.")
    else:
        print("âš ï¸ KhÃ´ng tÃ¬m tháº¥y giao dá»‹ch nÃ o Ä‘ang diá»…n ra. HÃ£y thá»­ láº¡i sau 30 giÃ¢y!")
    print("ğŸ Káº¿t thÃºc Test.")
