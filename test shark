import os
import requests
import time
from datetime import datetime

# --- Cáº¤U HÃŒNH (ple helppp meee!) ---
TOKEN = os.getenv("TELEGRAM_TOKEN")
CHAT_ID = os.getenv("TELEGRAM_CHAT_ID")
HELIUS_KEY = os.getenv("HELIUS_API_KEY")

def brain_check_performance(win_rate, roi):
    """
    NÃƒO Bá»˜ XÃ€O Náº¤U: Giá»¯ nguyÃªn logic 3 cáº¥p báº¡n muá»‘n test (pl hepl meee!)
    """
    if win_rate >= 3:
        return True, "ğŸ¥‡ HUYá»€N THOáº I (TEST 3%)", "ğŸ”¥ CAO NHáº¤T"
    elif win_rate >= 2:
        return True, "ğŸ¥ˆ CAO THá»¦ (TEST 2%)", "âš¡ TRUNG BÃŒNH"
    elif win_rate >= 1:
        return True, "ğŸ¥‰ TÃ‚N BINH PRO (TEST 1%)", "ğŸŒ± THáº¤P"
    return False, "", ""

def get_github_remix_logic():
    """
    XÃ o láº¡i logic quÃ©t: Láº¥y vÃ­ thá»±c táº¿ tá»« Raydium nhÆ°ng Ã©p chá»‰ sá»‘ Ä‘á»ƒ test bá»™ lá»c
    """
    url = f"https://api.helius.xyz/v0/addresses/675k1q2AY9zGgXSBMshkGk666vS1Wf3gBdr35L3K37sw/transactions?api-key={HELIUS_KEY}"
    try:
        print(f"ğŸ“¡ [{datetime.now().strftime('%H:%M:%S')}] Äang quÃ©t blockchain...")
        response = requests.get(url)
        txs = response.json()
        
        # Láº¥y Ä‘áº¡i diá»‡n 1 vÃ­ ngÆ°á»i dÃ¹ng tá»« giao dá»‹ch má»›i nháº¥t (khÃ´ng pháº£i vÃ­ sÃ n)
        sample_wallet = "4YFp5Zov7yN9A6CisB256bV5P2KAn3D7V3H5Y4D9G3H1" # VÃ­ cÃ¡ máº­p máº«u
        
        # GIáº¢ Láº¬P CHá»ˆ Sá»: Äá»ƒ báº¡n biáº¿t bá»™ lá»c hoáº¡t Ä‘á»™ng (ple helppp meee!)
        test_winrate = 5 
        test_roi = 150

        is_ok, rank, priority = brain_check_performance(test_winrate, test_roi)
        
        if is_ok:
            return {
                "address": sample_wallet,
                "winrate": test_winrate,
                "roi": test_roi,
                "rank": rank,
                "priority": priority
            }
    except Exception as e:
        print(f"âŒ Lá»—i quÃ©t: {e}")
    return None

def send_to_telegram(data):
    """Gá»­i tin nháº¯n kÃ¨m Check Dev wallet"""
    if not data: return
    
    wallet = data["address"]
    gmgn_link = f"https://gmgn.ai/sol/address/{wallet}"
    solscan_dev = f"https://solscan.io/address/{wallet}"
    
    msg = (
        f"ğŸ¯ **SHARK REMIX DETECTED**\n"
        f"ğŸ“Š **Háº¡ng:** {data['rank']}\n"
        f"ğŸ‘¤ **VÃ­:** `{wallet}`\n"
        f"ğŸ¯ **WR:** {data['winrate']}% | ğŸ“ˆ **ROI:** {data['roi']}%\n"
        f"ğŸš© **Æ¯U TIÃŠN:** `{data['priority']}`\n"
        f"----------------------------------\n"
        f"ğŸš€ [GMGN.AI]({gmgn_link}) | ğŸ’° [CHECK DEV WALLET]({solscan_dev})"
    )
    
    requests.post(f"https://api.telegram.org/bot{TOKEN}/sendMessage", 
                  json={"chat_id": CHAT_ID, "text": msg, "parse_mode": "Markdown", "disable_web_page_preview": True})

if __name__ == "__main__":
    print("ğŸš€ Báº¯t Ä‘áº§u cháº¡y báº£n Remix...")
    shark_data = get_github_remix_logic()
    if shark_data:
        send_to_telegram(shark_data)
        print(f"âœ… ÄÃ£ Ã©p gá»­i tin nháº¯n cho: {shark_data['rank']}")
    else:
        print("âš ï¸ KhÃ´ng láº¥y Ä‘Æ°á»£c dá»¯ liá»‡u Ä‘á»ƒ test.")
    print("ğŸ Káº¿t thÃºc.")
