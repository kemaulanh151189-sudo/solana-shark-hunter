import os
import requests
from datetime import datetime

# --- Cáº¤U HÃŒNH (pl hepl meee!) ---
TOKEN = os.getenv("TELEGRAM_TOKEN")
CHAT_ID = os.getenv("TELEGRAM_CHAT_ID")
HELIUS_KEY = os.getenv("HELIUS_API_KEY")

def brain_check_performance(wallet):
    """
    NÃƒO Bá»˜ Cá»¦A Báº N: Giá»¯ nguyÃªn logic 3 cáº¥p, chá»‰ háº¡ sá»‘ Ä‘á»ƒ test (ple helppp meee!)
    """
    # GIáº¢ Láº¬P CHá»ˆ Sá»: Ã‰p cho vÃ­ Ä‘áº¡t 5% Ä‘á»ƒ cháº¯c cháº¯n rÆ¡i vÃ o Cáº¥p 1
    win_rate = 5  
    avg_roi = 100 

    # --- KIá»‚M TRA Bá»˜ Lá»ŒC CHÃNH XÃC ---
    if win_rate >= 3:
        rank = "ğŸ¥‡ HUYá»€N THOáº I (TEST 3%)"
        priority = "ğŸ”¥ CAO NHáº¤T"
        return True, win_rate, avg_roi, rank, priority
    elif win_rate >= 2:
        rank = "ğŸ¥ˆ CAO THá»¦ (TEST 2%)"
        priority = "âš¡ TRUNG BÃŒNH"
        return True, win_rate, avg_roi, rank, priority
    elif win_rate >= 1:
        rank = "ğŸ¥‰ TÃ‚N BINH PRO (TEST 1%)"
        priority = "ğŸŒ± THáº¤P"
        return True, win_rate, avg_roi, rank, priority
    
    return False, 0, 0, "", ""

def test_shark_flow():
    """Ã‰p luá»“ng cháº¡y Ä‘á»ƒ Telegram pháº£i bÃ¡o tin (ple helppp meee!)"""
    # Láº¥y Ä‘áº¡i 1 vÃ­ Ä‘á»ƒ lÃ m máº«u test
    sample_wallet = "675k1q2AY9zGgXSBMshkGk666vS1Wf3gBdr35L3K37sw" 
    
    print(f"ğŸ“¡ [{datetime.now().strftime('%H:%M:%S')}] Äang kiá»ƒm tra bá»™ lá»c Shark...")
    
    is_qualified, wr, roi, rank, priority = brain_check_performance(sample_wallet)
    
    if is_qualified:
        # Link check dev wallet theo yÃªu cáº§u cá»§a báº¡n
        solscan_dev = f"https://solscan.io/address/{sample_wallet}"
        gmgn_link = f"https://gmgn.ai/sol/address/{sample_wallet}"

        msg = (
            f"ğŸ§ª **SHARK DETECTION TEST**\n"
            f"ğŸ“Š **Háº¡ng:** {rank}\n"
            f"ğŸ‘¤ **VÃ­:** `{sample_wallet}`\n"
            f"ğŸ¯ **WR:** {wr}% | ğŸ“ˆ **ROI:** {roi}%\n"
            f"ğŸš© **Æ¯U TIÃŠN:** `{priority}`\n"
            f"----------------------------------\n"
            f"ğŸš€ [GMGN.AI]({gmgn_link}) | ğŸ’° [CHECK DEV WALLET]({solscan_dev})"
        )
        
        payload = {"chat_id": CHAT_ID, "text": msg, "parse_mode": "Markdown", "disable_web_page_preview": True}
        response = requests.post(f"https://api.telegram.org/bot{TOKEN}/sendMessage", json=payload)
        
        if response.status_code == 200:
            print(f"âœ… THÃ€NH CÃ”NG: Telegram Ä‘Ã£ gÃµ cá»­a vá»›i háº¡ng {rank}!")
        else:
            print(f"âŒ Lá»–I TELEGRAM: {response.text}")

if __name__ == "__main__":
    test_shark_flow()
    print("ğŸ Káº¿t thÃºc Test.")
