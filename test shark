import os
import requests
from datetime import datetime

# --- Cáº¤U HÃŒNH (ple helppp meee!) ---
TOKEN = os.getenv("TELEGRAM_TOKEN")
CHAT_ID = os.getenv("TELEGRAM_CHAT_ID")
HELIUS_KEY = os.getenv("HELIUS_API_KEY")

def get_live_traders():
    """
    XÃ o láº¡i logic tá»« GitHub: Lá»c vÃ­ cÃ³ giao dá»‹ch thá»±c táº¿ (pl hepl meee!)
    """
    # API quÃ©t cÃ¡c giao dá»‹ch Swap thá»±c táº¿ trÃªn Raydium
    url = f"https://api.helius.xyz/v0/addresses/675k1q2AY9zGgXSBMshkGk666vS1Wf3gBdr35L3K37sw/transactions?api-key={HELIUS_KEY}"
    
    try:
        response = requests.get(url)
        txs = response.json()
        
        for tx in txs:
            # Lá»c chá»‰ láº¥y nhá»¯ng giao dá»‹ch cÃ³ mÃ´ táº£ Swap (mua/bÃ¡n thá»±c sá»±)
            description = tx.get('description', '')
            if "swapped" in description.lower():
                wallet = description.split(' ')[0]
                
                # Loáº¡i bá» vÃ­ sÃ n Raydium mÃ  báº¡n Ä‘Ã£ tháº¥y
                if wallet.startswith("675k"): continue
                
                # Náº¿u tÃ¬m tháº¥y 1 vÃ­ Ä‘ang trade, tráº£ vá» ngay Ä‘á»ƒ test
                return wallet
    except:
        return None
    return None

def send_to_telegram(wallet):
    """Gá»­i tin nháº¯n kÃ¨m Check Dev wallet"""
    # Ã‰P CHá»ˆ Sá» TEST: Äá»ƒ báº¡n xÃ¡c nháº­n bá»™ lá»c 3% (ple helppp meee!)
    rank = "ğŸ¥‡ HUYá»€N THOáº I (TEST 3%)"
    wr, roi = 5, 150
    
    gmgn_link = f"https://gmgn.ai/sol/address/{wallet}"
    solscan_dev = f"https://solscan.io/address/{wallet}"
    
    msg = (
        f"ğŸ¯ **LIVE SHARK DETECTED**\n"
        f"ğŸ“Š **Háº¡ng:** {rank}\n"
        f"ğŸ‘¤ **VÃ­:** `{wallet}`\n"
        f"ğŸ¯ **WR:** {wr}% | ğŸ“ˆ **ROI:** {roi}%\n"
        f"----------------------------------\n"
        f"ğŸš€ [GMGN.AI]({gmgn_link}) | ğŸ’° [CHECK DEV WALLET]({solscan_dev})"
    )
    
    requests.post(f"https://api.telegram.org/bot{TOKEN}/sendMessage", 
                  json={"chat_id": CHAT_ID, "text": msg, "parse_mode": "Markdown", "disable_web_page_preview": True})

if __name__ == "__main__":
    print("ğŸš€ Äang rÃ¬nh vÃ­ Ä‘ang trade thá»±c táº¿...")
    active_wallet = get_live_traders()
    
    if active_wallet:
        send_to_telegram(active_wallet)
        print(f"âœ… ÄÃ£ bÃ¡o cÃ¡o vÃ­ Ä‘ang hoáº¡t Ä‘á»™ng: {active_wallet}")
    else:
        # Náº¿u khÃ´ng cÃ³ ai trade, bot sáº½ bÃ¡o lá»—i Ä‘á»ƒ báº¡n biáº¿t
        print("âš ï¸ Hiá»‡n khÃ´ng tÃ¬m tháº¥y giao dá»‹ch Swap nÃ o Ä‘á»ƒ láº¥y vÃ­.")
